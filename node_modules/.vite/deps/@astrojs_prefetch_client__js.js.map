{
  "version": 3,
  "sources": ["../../throttles/dist/index.mjs", "../../@astrojs/prefetch/dist/requestIdleCallback.js", "../../@astrojs/prefetch/dist/client.js"],
  "sourcesContent": ["export default function (limit) {\r\n\tlimit = limit || 1;\r\n\tvar queue=[], wip=0;\r\n\r\n\tfunction toAdd(fn) {\r\n\t\tqueue.push(fn) > 1 || run(); // initializes if 1st\r\n\t}\r\n\r\n\tfunction isDone() {\r\n\t\twip--; // make room for next\r\n\t\trun();\r\n\t}\r\n\r\n\tfunction run() {\r\n\t\tif (wip < limit && queue.length > 0) {\r\n\t\t\tqueue.shift()(); wip++; // is now WIP\r\n\t\t}\r\n\t}\r\n\r\n\treturn [toAdd, isDone];\r\n}\r\n", "function shim(callback, options) {\r\n  const timeout = options?.timeout ?? 50;\r\n  const start = Date.now();\r\n  return setTimeout(function() {\r\n    callback({\r\n      didTimeout: false,\r\n      timeRemaining: function() {\r\n        return Math.max(0, timeout - (Date.now() - start));\r\n      }\r\n    });\r\n  }, 1);\r\n}\r\nconst requestIdleCallback = window.requestIdleCallback || shim;\r\nvar requestIdleCallback_default = requestIdleCallback;\r\nexport {\r\n  requestIdleCallback_default as default\r\n};\r\n", "import throttles from \"throttles\";\r\nimport requestIdleCallback from \"./requestIdleCallback.js\";\r\nconst events = [\"mouseenter\", \"touchstart\", \"focus\"];\r\nconst preloaded = /* @__PURE__ */ new Set();\r\nconst loadedStyles = /* @__PURE__ */ new Set();\r\nfunction shouldPreload({ href }) {\r\n  try {\r\n    const url = new URL(href);\r\n    return window.location.origin === url.origin && window.location.pathname !== url.pathname && !preloaded.has(href);\r\n  } catch {\r\n  }\r\n  return false;\r\n}\r\nlet parser;\r\nlet observer;\r\nfunction observe(link) {\r\n  preloaded.add(link.href);\r\n  observer.observe(link);\r\n  events.map((event) => link.addEventListener(event, onLinkEvent, { passive: true, once: true }));\r\n}\r\nfunction unobserve(link) {\r\n  observer.unobserve(link);\r\n  events.map((event) => link.removeEventListener(event, onLinkEvent));\r\n}\r\nfunction onLinkEvent({ target }) {\r\n  if (!(target instanceof HTMLAnchorElement)) {\r\n    return;\r\n  }\r\n  preloadHref(target);\r\n}\r\nasync function preloadHref(link) {\r\n  unobserve(link);\r\n  const { href } = link;\r\n  try {\r\n    const contents = await fetch(href).then((res) => res.text());\r\n    parser ||= new DOMParser();\r\n    const html = parser.parseFromString(contents, \"text/html\");\r\n    const styles = Array.from(html.querySelectorAll('link[rel=\"stylesheet\"]'));\r\n    await Promise.all(\r\n      styles.filter((el) => !loadedStyles.has(el.href)).map((el) => {\r\n        loadedStyles.add(el.href);\r\n        return fetch(el.href);\r\n      })\r\n    );\r\n  } catch {\r\n  }\r\n}\r\nfunction prefetch({\r\n  selector = 'a[href][rel~=\"prefetch\"]',\r\n  throttle = 1,\r\n  intentSelector = 'a[href][rel~=\"prefetch-intent\"]'\r\n}) {\r\n  if (!navigator.onLine) {\r\n    return Promise.reject(new Error(\"Cannot prefetch, no network connection\"));\r\n  }\r\n  if (\"connection\" in navigator) {\r\n    const connection = navigator.connection;\r\n    if (connection.saveData) {\r\n      return Promise.reject(new Error(\"Cannot prefetch, Save-Data is enabled\"));\r\n    }\r\n    if (/(2|3)g/.test(connection.effectiveType)) {\r\n      return Promise.reject(new Error(\"Cannot prefetch, network conditions are poor\"));\r\n    }\r\n  }\r\n  const [toAdd, isDone] = throttles(throttle);\r\n  observer = observer || new IntersectionObserver((entries) => {\r\n    entries.forEach((entry) => {\r\n      if (entry.isIntersecting && entry.target instanceof HTMLAnchorElement) {\r\n        const relAttributeValue = entry.target.getAttribute(\"rel\") || \"\";\r\n        let matchesIntentSelector = false;\r\n        if (Array.isArray(intentSelector)) {\r\n          matchesIntentSelector = intentSelector.some(\r\n            (intent) => relAttributeValue.includes(intent)\r\n          );\r\n        } else {\r\n          matchesIntentSelector = relAttributeValue.includes(intentSelector);\r\n        }\r\n        if (!matchesIntentSelector) {\r\n          toAdd(() => preloadHref(entry.target).finally(isDone));\r\n        }\r\n      }\r\n    });\r\n  });\r\n  requestIdleCallback(() => {\r\n    const links = [...document.querySelectorAll(selector)].filter(shouldPreload);\r\n    links.forEach(observe);\r\n    const intentSelectorFinal = Array.isArray(intentSelector) ? intentSelector.join(\",\") : intentSelector;\r\n    const intentLinks = [\r\n      ...document.querySelectorAll(intentSelectorFinal)\r\n    ].filter(shouldPreload);\r\n    intentLinks.forEach((link) => {\r\n      events.map(\r\n        (event) => link.addEventListener(event, onLinkEvent, { passive: true, once: true })\r\n      );\r\n    });\r\n  });\r\n}\r\nexport {\r\n  prefetch as default\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
